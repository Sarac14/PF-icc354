<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Projects - S & H MULTIMEDIA </title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Inter:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800&amp;display=swap">
    <link rel="stylesheet" href="/assets/css/Bootstrap-4---Payment-Form.css">
    <link rel="stylesheet" href="/assets/css/Bootstrap-4---Table-Fixed-Header.css">
    <link rel="stylesheet" href="/assets/css/Data-Table-styles.css">
    <link rel="stylesheet" href="/assets/css/Data-Table.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.6.5/css/buttons.dataTables.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="/assets/css/Login-Form-Basic-icons.css">
    <link rel="stylesheet" href="/assets/css/Ludens-Users---3-Profile.css">
    <link rel="stylesheet" href="/assets/css/Table-With-Search-search-table.css">
    <link rel="stylesheet" href="/assets/css/Table-With-Search.css">

    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
        }

        .modal-content {
            background-color: #232323;
            border-radius: 10px;
            width: 30%;
            padding: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(8.5px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            margin: 15% auto;
            animation: modalFadeIn 0.5s;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-check {
            display: flex;
            /*align-items: center;  Centra los elementos verticalmente */
            margin-bottom: 20px; /* Espacio debajo del conjunto checkbox + label */
        }

        .form-check-label {
            color: #ffffff; /* Estilo para el texto del label */
        }

        .form-label {
            display: block;
            color: #fff;
            margin-bottom: 10px;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
            border: none;
            color: #333;
        }

        .button-container {
            display: flex;
            justify-content: space-between;
        }

        .btn {
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-agregar {
            background-color: #4CAF50; /* Verde para el botón agregar */
            color: white;
        }

        .btn-agregar:hover {
            background-color: #45a049;
        }

        .btn-cancelar {
            background-color: #f44336; /* Rojo para el botón cancelar */
            color: white;
        }

        .btn-cancelar:hover {
            background-color: #d32f2f;
        }

        .card-same-height {
            min-height: 400px; /* Ajusta este valor según sea necesario */
        }
    </style>
</head>

<body>
<div th:replace="plantilla.html::menu"></div>
<section class="py-5">
    <div class="container bg-dark py-5">
        <div class="row">
            <div class="col-md-8 col-xl-6 text-center mx-auto">
                <p class="fw-bold text-success mb-2">Nuestros servicios</p>
                <h3 class="fw-bold">¿Cómo podemos ser parte de tu historia?</h3>
            </div>
        </div>
        <div class="py-5 p-lg-5">
            <div class="row row-cols-1 row-cols-md-3 mx-auto" style="max-width: 900px;">
                <div class="col mb-5">
                    <div class="card shadow-sm card-same-height" style="border-radius: 29px;">
                        <div class="card-body px-4 py-5 px-md-5"
                             style="color: var(--bs-body-color);background: var(--bs-body-bg);border-radius: 30px;">
                            <div class="bs-icon-lg d-flex justify-content-center align-items-center mb-3 bs-icon"
                                 style="top: 1rem;right: 1rem;position: absolute;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor"
                                     viewBox="0 0 16 16" class="bi bi-chat-heart-fill text-success">
                                </svg>
                            </div>
                            <h5 class="fw-bold card-title">Pre-Boda</h5><span class="badge bg-primary">RD$1,000</span>
                            <p class="text-muted card-text mb-4">Descubre la magia de anticipar el amor con nuestro
                                paquete exclusivo y personalizado de Fotos de Pre-Boda.&nbsp;</p>
                            <button class="btn btn-primary shadow add-to-cart" data-evento-id="Pre-Boda">Añadir al
                                carrito
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col mb-5">
                    <div class="card shadow-sm card-same-height" style="border-radius: 29px;">
                        <div class="card-body px-4 py-5 px-md-5"
                             style="background: var(--bs-body-bg);border-radius: 29px;">
                            <div class="bs-icon-lg d-flex justify-content-center align-items-center mb-3 bs-icon"
                                 style="top: 1rem;right: 1rem;position: absolute;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor"
                                     viewBox="0 0 16 16" class="bi bi-arrow-through-heart-fill text-success">
                                    <path fill-rule="evenodd"
                                          d="M2.854 15.854A.5.5 0 0 1 2 15.5V14H.5a.5.5 0 0 1-.354-.854l1.5-1.5A.5.5 0 0 1 2 11.5h1.793l3.103-3.104a.5.5 0 1 1 .708.708L4.5 12.207V14a.5.5 0 0 1-.146.354l-1.5 1.5ZM16 3.5a.5.5 0 0 1-.854.354L14 2.707l-1.006 1.006c.236.248.44.531.6.845.562 1.096.585 2.517-.213 4.092-.793 1.563-2.395 3.288-5.105 5.08L8 13.912l-.276-.182A23.825 23.825 0 0 1 5.8 12.323L8.31 9.81a1.5 1.5 0 0 0-2.122-2.122L3.657 10.22a8.827 8.827 0 0 1-1.039-1.57c-.798-1.576-.775-2.997-.213-4.093C3.426 2.565 6.18 1.809 8 3.233c1.25-.98 2.944-.928 4.212-.152L13.292 2 12.147.854A.5.5 0 0 1 12.5 0h3a.5.5 0 0 1 .5.5v3Z"></path>
                                </svg>
                            </div>
                            <h5 class="fw-bold card-title">Boda</h5><span class="badge bg-primary">RD$5,000</span>
                            <p class="text-muted card-text mb-4">Transforma el día más especial de tu vida en un cuento
                                de hadas eterno con nuestro paquete de Fotografías para tu Boda.</p>
                            <button class="btn btn-primary shadow add-to-cart" data-evento-id="Boda">Añadir al carrito
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col mb-5">
                    <div class="card shadow-sm card-same-height" style="border-radius: 29px;">
                        <div class="card-body px-4 py-5 px-md-5"
                             style="background: var(--bs-body-bg);border-radius: 30px;">
                            <div class="bs-icon-lg d-flex justify-content-center align-items-center mb-3 bs-icon"
                                 style="top: 1rem;right: 1rem;position: absolute;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor"
                                     viewBox="0 0 16 16" class="bi bi-balloon-fill text-success">
                                    <path fill-rule="evenodd"
                                          d="M8.48 10.901C11.211 10.227 13 7.837 13 5A5 5 0 0 0 3 5c0 2.837 1.789 5.227 4.52 5.901l-.244.487a.25.25 0 1 0 .448.224l.04-.08c.009.17.024.315.051.45.068.344.208.622.448 1.102l.013.028c.212.422.182.85.05 1.246-.135.402-.366.751-.534 1.003a.25.25 0 0 0 .416.278l.004-.007c.166-.248.431-.646.588-1.115.16-.479.212-1.051-.076-1.629-.258-.515-.365-.732-.419-1.004a2.376 2.376 0 0 1-.037-.289l.008.017a.25.25 0 1 0 .448-.224l-.244-.487ZM4.352 3.356a4.004 4.004 0 0 1 3.15-2.325C7.774.997 8 1.224 8 1.5c0 .276-.226.496-.498.542-.95.162-1.749.78-2.173 1.617a.595.595 0 0 1-.52.341c-.346 0-.599-.329-.457-.644Z"></path>
                                </svg>
                            </div>
                            <h5 class="fw-bold card-title">Cumpleaños&nbsp;</h5><span
                                class="badge bg-primary">RD$3,000</span>
                            <p class="text-muted card-text mb-4">Captura la alegría, la emoción y la diversión de tu día
                                especial de manera vibrante con nuestro paquete de Cumpleaños.</p>
                            <button class="btn btn-primary shadow add-to-cart" data-evento-id="Cumpleaños">Añadir al
                                carrito
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Ventana emergente -->
    <form id="miModal" class="modal">
        <div class="modal-content">
            <div>
                <label for="fechaEvento" class="form-label">Fecha del Evento:</label>
                <input type="date" id="fechaEvento" name="fechaEvento" class="form-input"><br>

                <label class="form-label">
                    <input type="checkbox" id="incluirVideo" name="incluirVideo">
                    Incluir Video (RD$4,000 adicional)
                </label><br>

                <div class="button-container">
                    <button type="submit" class="btn btn-agregar">Agregar</button>
                    <button type="button" id="cancelar" class="btn btn-cancelar">Cancelar</button>
                </div>
            </div>
        </div>
    </form>
</section>
<footer class="bg-dark"></footer>
<script src="/assets/bootstrap/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.6.0/umd/popper.min.js"></script>
<script src="/assets/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.5/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.flash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.print.min.js"></script>
<script src="/assets/js/DataTable---Fully-BSS-Editable-style.js"></script>
<script src="/assets/js/bold-and-dark.js"></script>
<script src="/assets/js/Bootstrap-4---Payment-Form-script.js"></script>
<script src="/assets/js/Table-With-Search-search-table.js"></script>

<script>
    // Variables globales
    let tipoEventoSeleccionado = '';
    const URL_API_EVENTOS = 'http://localhost:8081/evento'; // Asegúrate de que esta URL sea correcta

    document.addEventListener('DOMContentLoaded', () => {
        // Event listener para botones 'Añadir al carrito'
        document.querySelectorAll('.add-to-cart').forEach(button => {
            button.addEventListener('click', event => {
                // Verificar si el usuario está logueado
                const token = localStorage.getItem('token');
                if (token) {
                    // Usuario logueado, proceder normalmente
                    tipoEventoSeleccionado = button.getAttribute('data-evento-id');
                    document.getElementById('miModal').style.display = 'block';
                } else {
                    // Usuario no logueado, mostrar mensaje
                    alert('Por favor, inicia sesión para añadir eventos al carrito.');
                }
            });
        });


        const fechaEventoInput = document.getElementById('fechaEvento');
        const fechaActual = new Date();
        const diaSiguiente = new Date(fechaActual.getFullYear(), fechaActual.getMonth(), fechaActual.getDate() + 1);
        fechaEventoInput.min = diaSiguiente.toISOString().split('T')[0];

        // Event listener para cancelar la ventana modal
        document.getElementById('cancelar').addEventListener('click', () => {
            cerrarYLimpiarModal();
        });

        // Event listener para clic fuera de la ventana modal
        window.onclick = event => {
            if (event.target === document.getElementById('miModal')) {
                document.getElementById('miModal').style.display = "none";
            }
        };

        // Event listener para el envío del formulario
        document.getElementById('miModal').addEventListener('submit', event => {
            event.preventDefault();
            crearActualizarEvento();
        });
    });

    function obtenerIdCliente() {
        const token = localStorage.getItem('token');
        if (!token) {
            console.log('No token found');
            return null;
        }

        try {
            const decoded = jwt_decode(token);
            return decoded.idUser;
        } catch (error) {
            console.error('Error decodificando el token:', error);
            return null;
        }
    }

    function obtenerPrecioEvento(tipoEvento) {
        switch (tipoEvento) {
            case 'Pre-Boda':
                return 1000;
            case 'Boda':
                return 5000;
            case 'Cumpleaños':
                return 3000;
            default:
                return 0; // o manejar como un error
        }
    }


    function crearActualizarEvento() {
        const fechaEvento = document.getElementById('fechaEvento').value;
        const incluirVideo = document.getElementById('incluirVideo').checked;
        const precioEvento = obtenerPrecioEvento(tipoEventoSeleccionado);
        const costoAdicionalVideo = incluirVideo ? 4000 : 0;
        const total = precioEvento + costoAdicionalVideo;

        const evento = {
            idEncargado: null,
            idCliente: obtenerIdCliente(),
            fechaEvento: fechaEvento,
            fechaPago: null,
            total: total,
            tipoEvento: tipoEventoSeleccionado,
            incluirVideo: incluirVideo,
            pagado: "PENDIENTE"
        };

        axios.post(URL_API_EVENTOS, evento)
            .then(response => {
                console.log('Evento creado:', response.data);
                cerrarYLimpiarModal();
            })
            .catch(error => console.error('Error al crear el evento:', error));

    }

    function cerrarYLimpiarModal() {
        document.getElementById('miModal').style.display = "none";
        document.getElementById('miModal').reset();
        tipoEventoSeleccionado = '';
        total = 0;
        // Restablecer cualquier otro estado relevante
    }

</script>
</body>
</html>