<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Lista Usuarios</title>
    <!-- Required scripts -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">


    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800&amp;display=swap">
    <link rel="stylesheet" href="/assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/css/Bootstrap-4---Payment-Form.css">
    <link rel="stylesheet" href="/assets/css/Bootstrap-4---Table-Fixed-Header.css">
    <link rel="stylesheet" href="/assets/css/Data-Table-styles.css">
    <link rel="stylesheet" href="/assets/css/Data-Table.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.6.5/css/buttons.dataTables.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="/assets/css/Login-Form-Basic-icons.css">
    <link rel="stylesheet" href="/assets/css/Ludens-Users---3-Profile.css">
    <link rel="stylesheet" href="/assets/css/Table-With-Search-search-table.css">
    <link rel="stylesheet" href="/assets/css/Table-With-Search.css">
</head>

<body>
<div th:replace="plantilla.html::menu"></div>
<div id="app">
    <br>
    <br>
    <select v-model="vistaActual" class="form-select" aria-label="Seleccionar Grupo de Usuarios" style="width: 200px; max-width: 100%;">
        <option value="clientes">Clientes</option>
        <option value="admins">Admins</option>
    </select>


    <div class="table-responsive table table-hover table-bordered results" style="padding-top: 67px;" v-show="vistaActual === 'clientes'">
        <table class="table table-hover table-bordered">
            <thead class="bill-header cs">
                <tr>
                    <th id="trs-hd-1" class="col-lg-1"><span style="color: rgb(255, 255, 255);">Id</span></th>
                    <th id="trs-hd-2" class="col-lg-2"><span style="color: rgb(255, 255, 255);">Nombre&nbsp;</span></th>
                    <th id="trs-hd-3" class="col-lg-3"><span style="color: rgb(255, 255, 255);">Apellido</span></th>
                    <th id="trs-hd-4" class="col-lg-2"><span style="color: rgb(255, 255, 255);">Email</span></th>
                    <th id="trs-hd-5" class="col-lg-2"><span style="color: rgb(255, 255, 255);">Username</span></th>
                </tr>
            </thead>
            <tbody>
<!--                <tr class="warning no-result">-->
<!--                    <td colspan="12"><i class="fa fa-warning"></i>&nbsp; No Result !!!</td>-->
<!--                </tr>-->
                <tr v-for="cliente in clientes">
                    <td style="color: rgb(255, 255, 255);">{{cliente.id}}</td>
                    <td style="color: rgb(255, 255, 255);">{{cliente.nombre}}</td>
                    <td style="color: rgb(255, 255, 255);">{{cliente.apellido}}</td>
                    <td style="color: rgb(255, 255, 255);">{{cliente.email}}</td>
                    <td style="color: rgb(255, 255, 255);">{{cliente.username}}</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="table-responsive table table-hover table-bordered results" style="padding-top: 67px;" v-show="vistaActual === 'admins'">
        <table class="table table-hover table-bordered">
            <thead class="bill-header cs">
                <tr>
                    <th id="trs-hd-6" class="col-lg-1"><span style="color: rgb(255, 255, 255);">Id</span></th>
                    <th id="trs-hd-7" class="col-lg-2"><span style="color: rgb(255, 255, 255);">Nombre&nbsp;</span></th>
                    <th id="trs-hd-8" class="col-lg-3"><span style="color: rgb(255, 255, 255);">Apellido</span></th>
                    <th id="trs-hd-9" class="col-lg-2"><span style="color: rgb(255, 255, 255);">Email</span></th>
                    <th id="trs-hd-10" class="col-lg-2"><span style="color: rgb(255, 255, 255);">Username</span></th>
                </tr>
            </thead>
            <tbody>
            <!--                <tr class="warning no-result">-->
            <!--                    <td colspan="12"><i class="fa fa-warning"></i>&nbsp; No Result !!!</td>-->
            <!--                </tr>-->
            <tr v-for="admin in admins" :key="admin.id">
                <td style="color: rgb(255, 255, 255);">{{ admin.id }}</td>
                <td style="color: rgb(255, 255, 255);">{{ admin.nombre }}</td>
                <td style="color: rgb(255, 255, 255);">{{ admin.apellido }}</td>
                <td style="color: rgb(255, 255, 255);">{{ admin.email }}</td>
                <td style="color: rgb(255, 255, 255);">{{ admin.username }}</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
    <script src="/assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.6.0/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.5/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.flash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.print.min.js"></script>
    <script src="/assets/js/DataTable---Fully-BSS-Editable-style.js"></script>
    <script src="/assets/js/bold-and-dark.js"></script>
    <script src="/assets/js/Bootstrap-4---Payment-Form-script.js"></script>
    <script src="/assets/js/Table-With-Search-search-table.js"></script>


    <!-- Libreria Vuejs -->
    <script>

        /**
         * En caso de utilizar con API diferentes al dominio indicar la URL.
         */
        const NOMBRE_KEY = "API_URL";
        if(localStorage.getItem(NOMBRE_KEY) == null){
            localStorage.setItem(NOMBRE_KEY, "http://localhost:8081")
        }
        const URL_API = localStorage.getItem(NOMBRE_KEY);

        const { createApp } = Vue;

        const app = createApp({

            data(){
                return {
                    vistaActual: 'clientes',
                    titulo: "Creación de Estudiante",
                    editando: false,
                    nuevo: {
                        id: '',
                        nombre: '',
                        apellido: '',
                        email: '',
                        username: '',
                        password: '',
                        rols: ''


                    },
                    clientes: [],
                    admins: [],
                    modal: ""

                }
            },

            mounted() {
                console.log("Iniciando la aplicación en mounted: "+this.titulo);
                this.$nextTick(function () {  //garantizo que todos los elementos están renderizados.
                    console.log("Cargando todo el render del proyecto");
                    this.listaClientes();
                    this.modal = new bootstrap.Modal(document.getElementById('modal-1'));
                });
            },


            methods: {

                // listaClientes(){
                //     console.log("Cargando lista de Estudiante");
                //     axios.get(URL_API).then(response => {
                //         //
                //         console.log("Recuperando información del servidor");
                //         //
                //         this.clientes = response.data;
                //     }).catch(error => { console.log(error); });
                // },

                listaClientes(){
                    console.log("Cargando lista de Estudiante");
                    const url = `${URL_API}/user`;
                    axios.get(url).then(response => {
                        console.log("Recuperando información del servidor");
                        //this.clientes = response.data;
                        const listaUsuarios = response.data;

                        // Filtrar los usuarios en dos listas basadas en el rol
                        this.admins = listaUsuarios.filter(user =>
                            user.rols.some(rol => rol.role === 'ROLE_ADMIN'));
                        this.clientes = listaUsuarios.filter(user =>
                            user.rols.some(rol => rol.role === 'ROLE_USER'));

                    }).catch(error => {
                        console.log(error);
                    });
                },


            }
        });

        /**
         *
         */
        app.mount('#app');


    </script>
</body>

</html>